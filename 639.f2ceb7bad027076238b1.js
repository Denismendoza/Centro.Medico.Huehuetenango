"use strict";(self.webpackChunk_fuse_starter=self.webpackChunk_fuse_starter||[]).push([[639],{8639:(kt,O,a)=>{a.r(O),a.d(O,{MedicalHistoryModule:()=>Yt});var y=a(3423),P=a(8239),j=a(4762),T=a(574),u=a(6782),F=a(4395),C=a(3190),_=a(9765),V=a(9322),t=a(7716),Y=a(7495),I=a(2138),f=a(8002),g=a(5304),$=a(2340),J=a(1841),z=a(6215),v=a(5917);const x=$.N.API_URL;let w=(()=>{class n{constructor(e){this._http=e,this._onSelectedPatient=new _.xQ,this._medicHistories=new z.X([])}patientSelected(e){this._onSelectedPatient.next(e)}get patientSelected$(){return this._onSelectedPatient.asObservable()}get medicHistories$(){return this._medicHistories.asObservable()}searchAsync(e){return this._http.get(`${x}patient/search`,{params:{input:e}}).pipe((0,f.U)(i=>i&&(null==i?void 0:i.data)?null==i?void 0:i.data:[]),(0,g.K)(i=>(0,v.of)([])))}searchMedicineAsync(e){return this._http.get(`${x}medicine/search`,{params:{input:e}}).pipe((0,f.U)(i=>i&&(null==i?void 0:i.data)?null==i?void 0:i.data:[]),(0,g.K)(i=>(0,v.of)([])))}searchVaccineAsync(e){return this._http.get(`${x}vaccine/search`,{params:{input:e}}).pipe((0,f.U)(i=>i&&(null==i?void 0:i.data)?null==i?void 0:i.data:[]),(0,g.K)(i=>(0,v.of)([])))}findPaginated(e,i=1,o=10){const r=(new J.LE).append("page",i).append("pageSize",o).append("patientId",e);return this._http.get(`${x}medical-history/findPaginated`,{params:r}).pipe((0,f.U)(l=>(this._medicHistories.next(l.data),l)),(0,g.K)(l=>(0,v.of)(null)))}create(e){return this._http.post(`${x}medical-history/create`,e).pipe((0,f.U)(i=>null==i?void 0:i.stored),(0,g.K)(i=>(0,v.of)(!1)))}delete(e){return this._http.delete(`${x}medical-history/delete/${e}`).pipe((0,f.U)(i=>null==i?void 0:i.disabled),(0,g.K)(i=>(0,v.of)(!1)))}findOne(e){return this._http.get(`${x}medical-history/findById/${e}`).pipe((0,f.U)(i=>(null==i?void 0:i.data)?null==i?void 0:i.data:null),(0,g.K)(i=>(0,v.of)(null)))}onExport(e,i=1,o=1e3){var r=this;return(0,P.Z)(function*(){try{const l=(new J.LE).append("page",i).append("pageSize",o).append("patientId",e);return yield r._http.get(`${x}medical-history/findPaginated`,{params:l}).pipe((0,f.U)(p=>null==p?void 0:p.data),(0,g.K)(p=>(0,v.of)([]))).toPromise()}catch(l){return[]}})()}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(J.eN))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var m=a(8583),B=a(6682),M=a(1494),Q=a(9692),G=a(1452),Z=a(1095),k=a(1436),H=a(6627);function K(n,s){1&n&&t._UZ(0,"mat-icon",13),2&n&&t.Q6J("matTooltip","Oculto")}function X(n,s){1&n&&t._UZ(0,"mat-icon",14),2&n&&t.Q6J("matTooltip","Visible")}const W=function(n){return["/paciente/historial",n]};function tt(n,s){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",7),t.TgZ(2,"div",8),t._uU(3),t.qZA(),t.TgZ(4,"div",8),t._uU(5),t.ALo(6,"date"),t.qZA(),t.TgZ(7,"div",8),t._uU(8),t.qZA(),t.TgZ(9,"div",8),t.YNc(10,K,1,1,"mat-icon",9),t.YNc(11,X,1,1,"mat-icon",10),t.qZA(),t.TgZ(12,"div",8),t.TgZ(13,"button",11),t.NdJ("click",function(){const r=t.CHM(e).$implicit;return t.oxw(3).onDelete(null==r?null:r.identificator)}),t._UZ(14,"mat-icon",12),t.qZA(),t.qZA(),t.qZA(),t.BQk()}if(2&n){const e=s.$implicit;t.xp6(1),t.Q6J("routerLink",t.VKq(10,W,null==e?null:e.identificator)),t.xp6(2),t.Oqu(null==e?null:e.diagnosis),t.xp6(2),t.hij(" ",t.xi3(6,7,null==e?null:e.visitedAt,"dd/MM/yyyy")," "),t.xp6(3),t.hij(" ",null==e||null==e.doctor?null:e.doctor.displayName," "),t.xp6(2),t.Q6J("ngIf",0==+(null==e?null:e.isEnabled)),t.xp6(1),t.Q6J("ngIf",1==+(null==e?null:e.isEnabled)),t.xp6(2),t.Q6J("matTooltip","Ocultar cita")}}function et(n,s){if(1&n&&(t.ynx(0),t.YNc(1,tt,15,12,"ng-container",6),t.BQk()),2&n){const e=s.ngIf,i=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e)("ngForTrackBy",i.trackByFn)}}const it=function(n){return{"pointer-events-none":n}};function nt(n,s){if(1&n&&(t.ynx(0),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t.TgZ(3,"div",3),t._uU(4,"Diagnosis"),t.qZA(),t.TgZ(5,"div",4),t._uU(6,"Fecha de revisi\xf3n"),t.qZA(),t.TgZ(7,"div",4),t._uU(8,"M\xe9dico encargado"),t.qZA(),t.TgZ(9,"div",4),t._uU(10,"Estado"),t.qZA(),t.TgZ(11,"div",4),t._uU(12,"Opciones"),t.qZA(),t.qZA(),t.qZA(),t.YNc(13,et,2,2,"ng-container",0),t.ALo(14,"async"),t._UZ(15,"mat-paginator",5),t.BQk()),2&n){const e=t.oxw();t.xp6(3),t.Q6J("mat-sort-header","name"),t.xp6(10),t.Q6J("ngIf",t.lcZ(14,5,e.medicalHistories$)),t.xp6(2),t.Q6J("length",e.count)("pageSizeOptions",e.pageSizeOptions)("ngClass",t.VKq(7,it,e.loading))}}function ot(n,s){if(1&n&&(t.ynx(0),t.TgZ(1,"div",15),t._UZ(2,"mat-icon",16),t.TgZ(3,"div",17),t._uU(4),t.qZA(),t.qZA(),t.BQk()),2&n){const e=t.oxw();t.xp6(2),t.Q6J("svgIcon","heroicons_outline:document"),t.xp6(2),t.hij(" ",e.optionSelected?"No se han encontrado citas.":"Seleccione un paciente a revisar."," ")}}let st=(()=>{class n{constructor(e,i,o){this._snackbar=e,this._service=i,this._changeDetectorRef=o,this.loading=!1,this.medicalHistories=[],this.optionSelected=!1,this._unsubscribe=new _.xQ,this.page=1,this.pages=0,this.count=0,this.pageSize=10,this.pageSizeOptions=[10,15,25]}ngOnInit(){this._onListenSelectedPatient()}ngAfterViewInit(){this.sort&&this.paginator&&(this._changeDetectorRef.markForCheck(),(0,B.T)(this.sort.sortChange,this.paginator.page).pipe((0,C.w)(()=>(this.loading=!0,this.pageSize=this.paginator.pageSize,this._service.findPaginated(this.paginator.pageIndex+1,this.paginator.pageSize))),(0,f.U)(()=>this.loading=!1)).pipe((0,u.R)(this._unsubscribe)).subscribe())}ngOnDestroy(){this._unsubscribe.next(),this._unsubscribe.complete()}_findMedicalHistories(e,i=1,o=10){this.loading=!0,this._service.findPaginated(e,i,o).pipe((0,u.R)(this._unsubscribe)).subscribe(r=>{this.medicalHistories=null==r?void 0:r.data,this.count=null==r?void 0:r.count},()=>{this._snackbar.open("Ha ocurrido un error al obtener el historial m\xe9dico.")},()=>{this.loading=!1,this._changeDetectorRef.markForCheck()}),this.medicalHistories$=this._service.medicHistories$}_onListenSelectedPatient(){this._service.patientSelected$.pipe((0,u.R)(this._unsubscribe)).subscribe(e=>{e&&(this.optionSelected=!0,this.patientSelected=e,this._findMedicalHistories(e.id),this._changeDetectorRef.markForCheck())})}onDelete(e){this._service.delete(e).pipe((0,u.R)(this._unsubscribe)).subscribe(i=>{var o;this._snackbar.open(i?"Se ha ocultado el historial de manera exit\xf3sa.":"Ha ocurrido un error al ocultar el historial."),i&&this._findMedicalHistories(null===(o=this.patientSelected)||void 0===o?void 0:o.id,this.paginator.pageIndex+1,this.paginator.pageSize)})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(I.o),t.Y36(w),t.Y36(t.sBO))},n.\u0275cmp=t.Xpm({type:n,selectors:[["history-log"]],viewQuery:function(e,i){if(1&e&&(t.Gf(M.YE,5),t.Gf(Q.NW,5)),2&e){let o;t.iGM(o=t.CRH())&&(i.sort=o.first),t.iGM(o=t.CRH())&&(i.paginator=o.first)}},decls:2,vars:2,consts:[[4,"ngIf"],[1,"grid"],["matSort","","matSortDisableClear","",1,"inventory-history-grid","z-10","sticky","top-0","grid","gap-4","py-4","px-6","md:px-8","shadow","text-md","font-semibold","text-secondary","bg-gray-50","dark:bg-black","dark:bg-opacity-5"],[3,"mat-sort-header"],[1,"hidden","sm:block"],[1,"sm:absolute","sm:inset-x-0","sm:bottom-0","border-b","sm:border-t","sm:border-b-0","z-10","bg-gray-50","dark:bg-transparent",3,"length","pageSizeOptions","ngClass"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"inventory-history-grid","inventory-history-row-grid","grid","items-center","gap-4","py-3","px-6","md:px-8","border-b",3,"routerLink"],[1,"truncate"],["style","color: red","svgIcon","heroicons_outline:x-circle",3,"matTooltip",4,"ngIf"],["style","color: green","svgIcon","heroicons_outline:check-circle",3,"matTooltip",4,"ngIf"],["mat-stroked-button","",1,"min-w-10","min-h-7","h-7","px-2","leading-6","ml-2",3,"matTooltip","click"],["svgIcon","heroicons_outline:user-remove"],["svgIcon","heroicons_outline:x-circle",2,"color","red",3,"matTooltip"],["svgIcon","heroicons_outline:check-circle",2,"color","green",3,"matTooltip"],[1,"flex","flex-col","flex-auto","items-center","justify-center",2,"margin-top","17%"],[1,"icon-size-24",3,"svgIcon"],[1,"mt-4","text-2xl","font-semibold","tracking-tight","text-secondary"]],template:function(e,i){1&e&&(t.YNc(0,nt,16,9,"ng-container",0),t.YNc(1,ot,5,2,"ng-container",0)),2&e&&(t.Q6J("ngIf",i.count),t.xp6(1),t.Q6J("ngIf",!i.count&&!i.loading))},directives:[m.O5,M.YE,M.nU,Q.NW,m.mk,m.sg,y.rH,Z.lW,k.gM,H.Hw],pipes:[m.Ov,m.uU],styles:[".inventory-history-grid{grid-template-columns:auto 40px}@media (min-width: 600px){.inventory-history-grid{grid-template-columns:295px 236px 200px 150px 72px}}@media (min-width: 960px){.inventory-history-grid{grid-template-columns:112px auto 150px 112px 72px}}@media (min-width: 1280px){.inventory-history-grid{grid-template-columns:349px auto 150px 112px 180px}}.inventory-history-row-grid{height:70px}\n"],encapsulation:2,data:{animation:G.L},changeDetection:0}),n})();var A=a(8295),U=a(7441),c=a(3679),N=a(9983);const rt=["searchSelectInput"];function at(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"button",3),t.NdJ("click",function(){return t.CHM(e),t.oxw().onClearFilter()}),t.TgZ(1,"mat-icon"),t._uU(2,"close"),t.qZA(),t.qZA()}}let E=(()=>{class n{constructor(){this.placeholderLabel="Buscar",this._unsubscribe=new _.xQ,this.searchInputFormControl=new c.NI(""),this.searchValueOutput=new t.vpe}ngOnInit(){this._onListenInput()}ngOnDestroy(){this._unsubscribe.next(),this._unsubscribe.complete()}handleKeyDown(e){e.stopPropagation()}onClearFilter(){this.searchInputFormControl.setValue(""),this.searchSelectInput.nativeElement.focus()}_onListenInput(){this.searchInputFormControl.valueChanges.pipe((0,u.R)(this._unsubscribe)).subscribe(e=>this.searchValueOutput.emit(e))}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["select-filter"]],viewQuery:function(e,i){if(1&e&&t.Gf(rt,7,t.SBq),2&e){let o;t.iGM(o=t.CRH())&&(i.searchSelectInput=o.first)}},inputs:{placeholderLabel:"placeholderLabel"},outputs:{searchValueOutput:"searchValueOutput"},decls:3,vars:3,consts:[["matInput","","autocomplete","off",3,"placeholder","formControl","keydown"],["searchSelectInput",""],["mat-button","","mat-icon-button","","aria-label","Limpiar filtro",3,"click",4,"ngIf"],["mat-button","","mat-icon-button","","aria-label","Limpiar filtro",3,"click"]],template:function(e,i){1&e&&(t.TgZ(0,"input",0,1),t.NdJ("keydown",function(r){return i.handleKeyDown(r)}),t.qZA(),t.YNc(2,at,3,0,"button",2)),2&e&&(t.Q6J("placeholder",i.placeholderLabel)("formControl",i.searchInputFormControl),t.xp6(2),t.Q6J("ngIf",null==i.searchInputFormControl?null:i.searchInputFormControl.value))},directives:[N.Nt,c.Fj,c.JJ,c.oH,m.O5,Z.lW,H.Hw],styles:["[_nghost-%COMP%]{width:100%;display:flex;padding:12px 16px;position:relative;flex-direction:row;align-items:center;justify-content:flex-start;border-bottom:1px solid #ebebeb}"]}),n})();var S=a(2458);function lt(n,s){1&n&&(t.TgZ(0,"mat-option",15),t._uU(1," No existen resultados "),t.qZA())}function ct(n,s){if(1&n&&(t.TgZ(0,"mat-option",16),t._uU(1),t.qZA()),2&n){const e=s.$implicit;t.Q6J("value",null==e?null:e.displayName),t.xp6(1),t.hij(" ",null==e?null:e.displayName," ")}}function dt(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"mat-form-field",9),t.TgZ(1,"mat-select",10),t.NdJ("selectionChange",function(o){return t.CHM(e),t.oxw().onPatientSelected(o)})("openedChange",function(){return t.CHM(e),t.MAs(3).onClearFilter()}),t.TgZ(2,"select-filter",11,12),t.NdJ("searchValueOutput",function(o){return t.CHM(e),t.oxw().onFilterPatients(o)}),t.qZA(),t.YNc(4,lt,2,0,"mat-option",13),t.YNc(5,ct,2,2,"mat-option",14),t.qZA(),t.qZA()}if(2&n){const e=t.oxw();t.xp6(4),t.Q6J("ngIf",!(e.isLoadingPatients||null!=e.patients&&e.patients.length)),t.xp6(1),t.Q6J("ngForOf",e.patients)}}const ut=function(){return["/paciente/historial","nueva-cita"]};function mt(n,s){1&n&&(t.TgZ(0,"button",17),t._UZ(1,"mat-icon",18),t.TgZ(2,"span",19),t._uU(3,"Nueva cita"),t.qZA(),t.qZA()),2&n&&(t.Q6J("color","primary")("routerLink",t.DdM(3,ut)),t.xp6(1),t.Q6J("svgIcon","heroicons_outline:plus"))}function pt(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div",20),t.ynx(1),t.TgZ(2,"a",21),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return!o.loadingExport&&o.selectedPatient&&o.onExportData()}),t.TgZ(3,"div",22),t.TgZ(4,"div",23),t.TgZ(5,"div",24),t._UZ(6,"mat-icon",25),t.TgZ(7,"div",26),t._uU(8," XLSX "),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.BQk(),t.qZA()}if(2&n){const e=t.oxw();t.xp6(2),t.ekj("cursor-not-allowed",e.loadingExport||!e.selectedPatient)("bg-gray-300",e.loadingExport),t.xp6(4),t.Q6J("svgIcon","iconsmind:file")}}function _t(n,s){1&n&&(t.TgZ(0,"mat-error"),t._uU(1," Campo requerido. "),t.qZA())}function ft(n,s){1&n&&(t.TgZ(0,"mat-option",28),t._uU(1," No existen resultados "),t.qZA())}function gt(n,s){if(1&n&&(t.TgZ(0,"mat-option",29),t._uU(1),t.qZA()),2&n){const e=s.$implicit;t.Q6J("value",null==e?null:e.id),t.xp6(1),t.hij(" ",null==e?null:e.displayName," ")}}function vt(n,s){1&n&&(t.TgZ(0,"mat-error"),t._uU(1," Campo requerido. "),t.qZA())}function xt(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"mat-form-field",13),t.TgZ(1,"mat-label"),t._uU(2,"Paciente"),t.qZA(),t.TgZ(3,"mat-select",23),t.NdJ("openedChange",function(){return t.CHM(e),t.MAs(5).onClearFilter()}),t.TgZ(4,"select-filter",24,25),t.NdJ("searchValueOutput",function(o){return t.CHM(e),t.oxw().onFilterPatients(o)}),t.qZA(),t.YNc(6,ft,2,0,"mat-option",26),t.YNc(7,gt,2,2,"mat-option",27),t.qZA(),t.YNc(8,vt,2,0,"mat-error",15),t.qZA()}if(2&n){const e=t.oxw();t.xp6(3),t.Q6J("required",!0),t.xp6(3),t.Q6J("ngIf",!(e.isLoadingPatients||null!=e.patients&&e.patients.length)),t.xp6(1),t.Q6J("ngForOf",e.patients),t.xp6(1),t.Q6J("ngIf",e.Form.get("userId").hasError("required"))}}function yt(n,s){1&n&&(t.TgZ(0,"mat-form-field",13),t._UZ(1,"input",30),t.TgZ(2,"mat-label"),t._uU(3,"Paciente"),t.qZA(),t.qZA()),2&n&&(t.xp6(1),t.Q6J("required",!0))}function Zt(n,s){1&n&&(t.TgZ(0,"mat-option",28),t._uU(1," No existen resultados "),t.qZA())}function bt(n,s){if(1&n&&(t.TgZ(0,"mat-option",34),t._uU(1),t.qZA()),2&n){const e=s.$implicit,i=t.oxw(2);t.Q6J("value",null==e?null:e.id)("selected",i.selectedMedicines.includes(null==e?null:e.id)),t.xp6(1),t.hij(" ",null==e?null:e.name," ")}}function Tt(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"mat-form-field",13),t.TgZ(1,"mat-label"),t._uU(2,"Medicinas"),t.qZA(),t.TgZ(3,"mat-select",31),t.NdJ("openedChange",function(){return t.CHM(e),t.MAs(5).onClearFilter()})("selectionChange",function(o){return t.CHM(e),t.oxw().onSelectionChange(o.value)}),t.TgZ(4,"select-filter",24,32),t.NdJ("searchValueOutput",function(o){return t.CHM(e),t.oxw().onFilterMedicines(o)}),t.qZA(),t.YNc(6,Zt,2,0,"mat-option",26),t.YNc(7,bt,2,3,"mat-option",33),t.qZA(),t.qZA()}if(2&n){const e=t.oxw();t.xp6(3),t.Q6J("multiple",!0),t.xp6(3),t.Q6J("ngIf",!(e.isLoadingMedicines||null!=e.medicaments&&e.medicaments.length)),t.xp6(1),t.Q6J("ngForOf",e.medicaments)}}function Ct(n,s){if(1&n&&(t.TgZ(0,"mat-option",34),t._uU(1),t.qZA()),2&n){const e=s.$implicit,i=t.oxw(2);t.Q6J("value",null==e?null:e.id)("selected",i.selectedMedicines.includes(null==e?null:e.id)),t.xp6(1),t.hij(" ",null==e?null:e.name," ")}}function Ht(n,s){if(1&n&&(t.TgZ(0,"mat-form-field",13),t.TgZ(1,"mat-label"),t._uU(2,"Medicinas"),t.qZA(),t.TgZ(3,"mat-select",35),t.YNc(4,Ct,2,3,"mat-option",33),t.qZA(),t.qZA()),2&n){const e=t.oxw();t.xp6(3),t.Q6J("multiple",!0),t.xp6(1),t.Q6J("ngForOf",e.medicaments)}}function At(n,s){1&n&&(t.TgZ(0,"mat-option",28),t._uU(1," No existen resultados "),t.qZA())}function Ft(n,s){if(1&n&&(t.TgZ(0,"mat-option",34),t._uU(1),t.qZA()),2&n){const e=s.$implicit,i=t.oxw(2);t.Q6J("value",null==e?null:e.id)("selected",i.selectedVaccines.includes(null==e?null:e.id)),t.xp6(1),t.hij(" ",null==e?null:e.name," ")}}function It(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"mat-form-field",13),t.TgZ(1,"mat-label"),t._uU(2,"Vacunas"),t.qZA(),t.TgZ(3,"mat-select",36),t.NdJ("openedChange",function(){return t.CHM(e),t.MAs(5).onClearFilter()})("selectionChange",function(o){return t.CHM(e),t.oxw().onVaccineChange(o.value)}),t.TgZ(4,"select-filter",24,37),t.NdJ("searchValueOutput",function(o){return t.CHM(e),t.oxw().onFilterVaccines(o)}),t.qZA(),t.YNc(6,At,2,0,"mat-option",26),t.YNc(7,Ft,2,3,"mat-option",33),t.qZA(),t.qZA()}if(2&n){const e=t.oxw();t.xp6(3),t.Q6J("multiple",!0),t.xp6(3),t.Q6J("ngIf",!(e.isLoadingVaccines||null!=e.vaccines&&e.vaccines.length)),t.xp6(1),t.Q6J("ngForOf",e.vaccines)}}function Mt(n,s){if(1&n&&(t.TgZ(0,"mat-option",34),t._uU(1),t.qZA()),2&n){const e=s.$implicit,i=t.oxw(2);t.Q6J("value",null==e?null:e.id)("selected",i.selectedVaccines.includes(null==e?null:e.id)),t.xp6(1),t.hij(" ",null==e?null:e.name," ")}}function Nt(n,s){if(1&n&&(t.TgZ(0,"mat-form-field",13),t.TgZ(1,"mat-label"),t._uU(2,"Vacunas"),t.qZA(),t.TgZ(3,"mat-select",38),t.YNc(4,Mt,2,3,"mat-option",33),t.qZA(),t.qZA()),2&n){const e=t.oxw();t.xp6(3),t.Q6J("multiple",!0),t.xp6(1),t.Q6J("ngForOf",e.vaccines)}}function qt(n,s){1&n&&(t.TgZ(0,"mat-error"),t._uU(1," Campo requerido. "),t.qZA())}function Jt(n,s){1&n&&(t.TgZ(0,"mat-error"),t._uU(1," Campo requerido. "),t.qZA())}function wt(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"button",39),t.NdJ("click",function(){return t.CHM(e),t.oxw().onRegister()}),t._uU(1," Registrar cita "),t.qZA()}if(2&n){const e=t.oxw();t.Q6J("color","primary")("disabled",e.Form.invalid||e.Form.pristine)}}const Qt=function(){return["/paciente/historial"]},Ut=[{path:"",component:(()=>{class n{constructor(e,i,o,r){this._session=e,this._cdr=i,this._snackbar=o,this._service=r,this._search=new _.xQ,this._unsubscribe=new _.xQ,this.patients=[],this.canManage=!1,this.loadingExport=!1,this.isLoadingPatients=!1}ngOnInit(){this._getSession(),this._onFilterPatients()}ngAfterViewInit(){this._onGetRecords(),this._cdr.detectChanges()}ngOnDestroy(){this._unsubscribe.next(),this._unsubscribe.complete()}_getSession(){this._session.user$.pipe((0,u.R)(this._unsubscribe)).subscribe(e=>{this.user=e,this.canManage=3!=(null==e?void 0:e.role)})}_onFilterPatients(){this._search.pipe((0,F.b)(500),(0,C.w)(e=>this._service.searchAsync(e)),(0,u.R)(this._unsubscribe)).subscribe(e=>{this.patients=e},e=>{this.patients=[]},()=>{this.isLoadingPatients=!1})}_onGetRecords(){var e,i,o,r;3==(null===(e=this.user)||void 0===e?void 0:e.role)&&(this.selectedPatient={id:+(null===(i=this.user)||void 0===i?void 0:i.id),email:null===(o=this.user)||void 0===o?void 0:o.email,displayName:null===(r=this.user)||void 0===r?void 0:r.name},this._service.patientSelected(this.selectedPatient))}onFilterPatients(e){!e||(this.isLoadingPatients=!0,this._search.next(e))}onPatientSelected(e){const i=e.value,o=this.patients.find(r=>(null==r?void 0:r.displayName)===i);this.selectedPatient=o,this._service.patientSelected(this.selectedPatient)}onExportData(){var e=this;return(0,P.Z)(function*(){var i;try{if(!e.selectedPatient&&!(null===(i=e.selectedPatient)||void 0===i?void 0:i.id))return;e.loadingExport=!0;const r=(yield e._service.onExport(e.selectedPatient.id)).map(b=>{var D,L,d=(0,j._T)(b,["id"]);return{"N\xfamero de cita":null==d?void 0:d.identificator,Tratamiento:null==d?void 0:d.treatment,"Fecha de visita":(0,V.M)(null===(D=null==d?void 0:d.visitedAt)||void 0===D?void 0:D.toString()),Diagn\u00f3stico:null==d?void 0:d.diagnosis,"Notas adicionales":null==d?void 0:d.notes,"M\xe9dico encargado":null===(L=null==d?void 0:d.doctor)||void 0===L?void 0:L.displayName}}),l=(0,V.k)(),h=`${l}.xlsx`,p=T.P6.aoa_to_sheet([]),q=T.P6.book_new();T.P6.sheet_add_json(p,r),T.P6.book_append_sheet(q,p,l),T.NC(q,h)}catch(o){return e._snackbar.open("Ha ocurrido un error al exportar el historial m\xe9dico.")}finally{e.loadingExport=!1}})()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(Y.K),t.Y36(t.sBO),t.Y36(I.o),t.Y36(w))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-medical-history"]],decls:11,vars:3,consts:[[1,"sm:absolute","sm:inset-0","flex","flex-col","flex-auto","min-w-0","sm:overflow-hidden","bg-card","dark:bg-transparent"],[1,"relative","flex","flex-col","sm:flex-row","flex-0","sm:items-center","sm:justify-between","py-8","px-6","md:px-8","border-b"],[1,"text-4xl","font-extrabold","tracking-tight"],[1,"flex","flex-shrink-0","items-center","mt-6","sm:mt-0","sm:ml-4"],["class","fuse-mat-dense fuse-mat-no-subscript fuse-mat-rounded min-w-64",4,"ngIf"],["class","ml-4","mat-flat-button","",3,"color","routerLink",4,"ngIf"],["class","flex flex-wrap ml-2 mt-2",4,"ngIf"],[1,"flex","flex-auto","overflow-hidden"],[1,"flex","flex-col","flex-auto","sm:mb-18","overflow-hidden","sm:overflow-y-auto"],[1,"fuse-mat-dense","fuse-mat-no-subscript","fuse-mat-rounded","min-w-64"],[3,"selectionChange","openedChange"],["placeholderLabel","Buscar...",3,"searchValueOutput"],["patientsFilterControl",""],["disabled","",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],["disabled",""],[3,"value"],["mat-flat-button","",1,"ml-4",3,"color","routerLink"],[3,"svgIcon"],[1,"ml-2","mr-1"],[1,"flex","flex-wrap","ml-2","mt-2"],[1,"flex","flex-col","w-18","h-18","m-2","p-4","rounded-2xl","cursor-pointer","bg-card",3,"click"],[1,"aspect-w-9","aspect-h-6"],[1,"flex","items-center","justify-center"],[1,"relative"],[1,"icon-size-14","text-hint",3,"svgIcon"],[1,"absolute","left-0","bottom-0","px-1.5","rounded","text-sm","font-semibold","leading-5","text-white","bg-green-600"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t._uU(3," Historial m\xe9dico "),t.qZA(),t.TgZ(4,"div",3),t.YNc(5,dt,6,2,"mat-form-field",4),t.YNc(6,mt,4,4,"button",5),t.YNc(7,pt,9,5,"div",6),t.qZA(),t.qZA(),t.TgZ(8,"div",7),t.TgZ(9,"div",8),t._UZ(10,"history-log"),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(5),t.Q6J("ngIf",i.canManage),t.xp6(1),t.Q6J("ngIf",i.canManage),t.xp6(1),t.Q6J("ngIf",i.canManage))},directives:[m.O5,st,A.KE,U.gD,E,m.sg,S.ey,Z.lW,y.rH,H.Hw],styles:[""]}),n})()},{path:":id",component:(()=>{class n{constructor(e,i,o,r,l,h,p){this._router=e,this._fb=i,this._session=o,this._route=r,this._snackbar=l,this._service=h,this._changeDetectorRef=p,this.currentDate=new Date,this._unsubscribe=new _.xQ,this.patients=[],this.isLoadingPatients=!1,this.medicaments=[],this.isLoadingMedicines=!1,this.vaccines=[],this.isLoadingVaccines=!1,this._search=new _.xQ,this._vaccineSearch=new _.xQ,this._medicineSearch=new _.xQ,this.selectedVaccines=[],this.selectedMedicines=[],this.maxLengthNotes=150,this.maxLengthDiagnosis=300,this.maxLengthTreatment=300,this.isNewHistory=!0,this.loadingHistory=!1}ngOnInit(){this._onGetParam(),this._getSession(),this._initForm(),this._onFilterPatients(),this._onFilterVaccines(),this._onFilterMedicines()}ngOnDestroy(){this._unsubscribe.next(),this._unsubscribe.complete()}_initForm(){var e;this.Form=this._fb.group({vaccineIds:[],medicineIds:[],notes:["",[c.kI.required]],userId:["",[c.kI.required]],diagnosis:["",[c.kI.required]],treatment:["",[c.kI.required]],doctorId:[(null===(e=this.doctor)||void 0===e?void 0:e.id)||null,[c.kI.required]]})}_getSession(){this._session.user$.pipe((0,u.R)(this._unsubscribe)).subscribe(e=>{this.doctor=e,this._changeDetectorRef.markForCheck()})}_onFilterPatients(){this._search.pipe((0,F.b)(500),(0,C.w)(e=>this._service.searchAsync(e)),(0,u.R)(this._unsubscribe)).subscribe(e=>{this.patients=e},e=>{this.patients=[]},()=>{this.isLoadingPatients=!1})}_onFilterMedicines(){this._medicineSearch.pipe((0,F.b)(500),(0,C.w)(e=>this._service.searchMedicineAsync(e)),(0,u.R)(this._unsubscribe)).subscribe(e=>{const i=[...this.medicaments,...e].filter((o,r,l)=>r===l.findIndex(h=>h.id===o.id));this.medicaments=i},e=>{this.medicaments=[]},()=>{this.isLoadingMedicines=!1})}_onFilterVaccines(){this._vaccineSearch.pipe((0,F.b)(500),(0,C.w)(e=>this._service.searchVaccineAsync(e)),(0,u.R)(this._unsubscribe)).subscribe(e=>{const i=[...this.vaccines,...e].filter((o,r,l)=>r===l.findIndex(h=>h.id===o.id));this.vaccines=i},e=>{this.vaccines=[]},()=>{this.isLoadingVaccines=!1})}_onGetParam(){const e=this._route.snapshot.paramMap.get("id");e||this._router.navigate(["../"]),"nueva-cita"!==e&&(this.isNewHistory=!1,this._onGetMedicHistory(+e))}_onGetMedicHistory(e){this.loadingHistory=!0,this._service.findOne(e).pipe((0,u.R)(this._unsubscribe)).subscribe(i=>{i?(this.history=i,this._onSetData()):this._router.navigate(["/paciente/historial"])},i=>{this._router.navigate(["/paciente/historial"])},()=>{this.loadingHistory=!1})}_onSetData(){var e,i,o,r,l;this.Form.patchValue({notes:null===(e=this.history)||void 0===e?void 0:e.notes,diagnosis:null===(i=this.history)||void 0===i?void 0:i.diagnosis,treatment:null===(o=this.history)||void 0===o?void 0:o.treatment,userId:null===(l=null===(r=this.history)||void 0===r?void 0:r.patient)||void 0===l?void 0:l.displayName});const{medicines:h,vaccines:p}=this.history;this._handleUserVaccine(p),this._handleUserMedicine(h),Object.keys(this.Form.controls).forEach(q=>{var b;null===(b=this.Form.get(q))||void 0===b||b.disable({onlySelf:!0,emitEvent:!1})})}_handleUserMedicine(e){if(!e||!(null==e?void 0:e.length))return;const i=null==e?void 0:e.map(o=>Object.assign({},null==o?void 0:o.medicine));this.medicaments=i,this.selectedMedicines=null==i?void 0:i.map(o=>null==o?void 0:o.id),this.Form.patchValue({medicineIds:this.selectedMedicines})}_handleUserVaccine(e){if(!e||!(null==e?void 0:e.length))return;const i=null==e?void 0:e.map(o=>Object.assign({},null==o?void 0:o.vaccine));this.vaccines=i,this.selectedVaccines=null==i?void 0:i.map(o=>null==o?void 0:o.id),this.Form.patchValue({vaccineIds:this.selectedVaccines})}onFilterPatients(e){!e||(this.isLoadingPatients=!0,this._search.next(e))}onFilterMedicines(e){!e||(this.isLoadingMedicines=!0,this._medicineSearch.next(e))}onFilterVaccines(e){!e||(this.isLoadingVaccines=!0,this._vaccineSearch.next(e))}onSelectionChange(e){this.selectedMedicines=e}onVaccineChange(e){this.selectedVaccines=e}onRegister(){if(this.Form.invalid)return Object.values(this.Form.controls).forEach(e=>e.markAsTouched());this._service.create(this.Form.getRawValue()).pipe((0,u.R)(this._unsubscribe)).subscribe(e=>{this._snackbar.open(e?"El historial m\xe9dico se ha creado exit\xf3samente.":"Ha ocurrido un error al crear el historial m\xe9dico.")},e=>{this._snackbar.open("Ha ocurrido un error al crear el historial m\xe9dico.")},()=>{setTimeout(()=>{this._router.navigate(["/paciente/historial"])},1e3)})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(y.F0),t.Y36(c.qu),t.Y36(Y.K),t.Y36(y.gz),t.Y36(I.o),t.Y36(w),t.Y36(t.sBO))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-history-detail"]],decls:44,vars:29,consts:[[1,"flex","flex-col","flex-auto","min-w-0"],[1,"flex","flex-col","flex-auto","items-center","p-6","sm:p-10"],[1,"flex","flex-col","w-full","max-w-4xl"],[1,"-ml-4","sm:mt-8"],["mat-button","",3,"routerLink","color"],[3,"svgIcon"],[1,"ml-2"],[1,"mt-2","text-4xl","sm:text-7xl","font-extrabold","tracking-tight","leading-tight"],[1,"mt-8","sm:mt-12","p-6","pb-7","sm:p-10","sm:pb-7","shadow","rounded-2xl","bg-card"],["name","Form",1,"space-y-3",3,"formGroup"],[1,"mb-6"],[1,"text-2xl","font-bold","tracking-tight"],[1,"text-secondary"],[1,"w-full"],["matInput","","formControlName","diagnosis",3,"required","maxlength"],[4,"ngIf"],["class","w-full",4,"ngIf"],[1,"fuse-mat-textarea","w-full"],["matInput","","matTextareaAutosize","","formControlName","treatment",3,"rows","required","maxlength"],["matInput","","matTextareaAutosize","","formControlName","notes",3,"rows","required","maxlength"],["notes",""],[1,"flex","items-center","justify-end"],["class","ml-2","mat-flat-button","",3,"color","disabled","click",4,"ngIf"],["formControlName","userId",3,"required","openedChange"],["placeholderLabel","Buscar...",3,"searchValueOutput"],["patientsFilterControl",""],["disabled","",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],["disabled",""],[3,"value"],["matInput","","formControlName","userId",3,"required"],["formControlName","medicineIds",3,"multiple","openedChange","selectionChange"],["medicinesFilterControl",""],[3,"value","selected",4,"ngFor","ngForOf"],[3,"value","selected"],["formControlName","medicineIds",3,"multiple"],["formControlName","vaccineIds",3,"multiple","openedChange","selectionChange"],["vaccinesFilterControl",""],["formControlName","vaccineIds",3,"multiple"],["mat-flat-button","",1,"ml-2",3,"color","disabled","click"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t.TgZ(3,"div",3),t.TgZ(4,"a",4),t._UZ(5,"mat-icon",5),t.TgZ(6,"span",6),t._uU(7,"Volver"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(8,"div",7),t._uU(9),t.qZA(),t.TgZ(10,"div",8),t.TgZ(11,"form",9),t.TgZ(12,"div",10),t.TgZ(13,"div",11),t._uU(14),t.ALo(15,"date"),t.qZA(),t.TgZ(16,"div",12),t._uU(17," Revisado por: "),t.TgZ(18,"strong"),t._uU(19),t.qZA(),t.qZA(),t.qZA(),t.TgZ(20,"mat-form-field",13),t._UZ(21,"input",14),t.TgZ(22,"mat-label"),t._uU(23,"Diagnosis"),t.qZA(),t.YNc(24,_t,2,0,"mat-error",15),t.qZA(),t.YNc(25,xt,9,4,"mat-form-field",16),t.YNc(26,yt,4,1,"mat-form-field",16),t.YNc(27,Tt,8,3,"mat-form-field",16),t.YNc(28,Ht,5,2,"mat-form-field",16),t.YNc(29,It,8,3,"mat-form-field",16),t.YNc(30,Nt,5,2,"mat-form-field",16),t.TgZ(31,"mat-form-field",17),t._UZ(32,"textarea",18),t.TgZ(33,"mat-label"),t._uU(34,"Descripci\xf3n m\xe9dica"),t.qZA(),t.YNc(35,qt,2,0,"mat-error",15),t.qZA(),t.TgZ(36,"mat-form-field",17),t._UZ(37,"textarea",19,20),t.TgZ(39,"mat-label"),t._uU(40,"Notas adicionales"),t.qZA(),t.YNc(41,Jt,2,0,"mat-error",15),t.qZA(),t.TgZ(42,"div",21),t.YNc(43,wt,2,2,"button",22),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(4),t.Q6J("routerLink",t.DdM(28,Qt))("color","primary"),t.xp6(1),t.Q6J("svgIcon","heroicons_outline:arrow-narrow-left"),t.xp6(4),t.hij(" ",null!=i.history&&i.history.identificator?"Cita No. #"+(null==i.history?null:i.history.identificator):"Nueva cita"," "),t.xp6(2),t.Q6J("formGroup",i.Form),t.xp6(3),t.hij(" ",t.xi3(15,25,null!=i.history&&i.history.visitedAt?null==i.history?null:i.history.visitedAt:i.currentDate,"dd/MM/yyyy")," "),t.xp6(5),t.Oqu(null!=i.history&&i.history.doctor?null==i.history||null==i.history.doctor?null:i.history.doctor.displayName:null==i.doctor?null:i.doctor.name),t.xp6(2),t.Q6J("required",!0)("maxlength",i.maxLengthDiagnosis),t.xp6(3),t.Q6J("ngIf",i.Form.get("diagnosis").hasError("required")),t.xp6(1),t.Q6J("ngIf",i.isNewHistory),t.xp6(1),t.Q6J("ngIf",!i.isNewHistory),t.xp6(1),t.Q6J("ngIf",i.isNewHistory),t.xp6(1),t.Q6J("ngIf",!i.isNewHistory),t.xp6(1),t.Q6J("ngIf",i.isNewHistory),t.xp6(1),t.Q6J("ngIf",!i.isNewHistory),t.xp6(2),t.Q6J("rows",5)("required",!0)("maxlength",i.maxLengthTreatment),t.xp6(3),t.Q6J("ngIf",i.Form.get("treatment").hasError("required")),t.xp6(2),t.Q6J("rows",5)("required",!0)("maxlength",i.maxLengthNotes),t.xp6(4),t.Q6J("ngIf",i.Form.get("notes").hasError("required")),t.xp6(2),t.Q6J("ngIf",i.isNewHistory))},directives:[Z.zs,y.yS,H.Hw,c._Y,c.JL,c.sg,A.KE,N.Nt,c.Fj,c.JJ,c.u,c.Q7,c.nD,A.hX,m.O5,N.D7,A.TO,U.gD,E,m.sg,S.ey,Z.lW],pipes:[m.uU],styles:[".mat-input-element[_ngcontent-%COMP%]:disabled{color:#000!important}"]}),n})()}];let St=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[y.Bz.forChild(Ut)],y.Bz]}),n})();var Dt=a(3935),Lt=a(4466),Ot=a(2238),Pt=a(7539),Vt=a(2178),R=a(5396);let Yt=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({providers:[I.o],imports:[[St,Lt.m,H.Ps,Dt.Tx,M.JX,N.c,U.LD,Z.ot,S.si,Ot.Is,k.AV,Pt.p9,Q.TU,A.lN,Vt.Cv,R.rP,R.rP]]}),n})()}}]);